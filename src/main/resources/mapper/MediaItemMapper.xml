<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.acgm.acgmmediatracker.mapper.MediaItemMapper">

    <resultMap id="MediaItemResultMap" type="com.acgm.acgmmediatracker.entity.MediaItem">
        <id property="id" column="id" />
        <result property="userId" column="user_id" />
        <result property="libraryId" column="library_id" />
        <result property="status" column="status" />
        <result property="rating" column="rating" />
        <result property="notes" column="notes" />
        <result property="startDate" column="start_date" />
        <result property="finishDate" column="finish_date" />
        <result property="customTitle" column="custom_title" />
        <result property="customCoverUrl" column="custom_cover_url" />
        <result property="customSource" column="custom_source" />
        <result property="createdAt" column="created_at" />
        <result property="updatedAt" column="updated_at" />
        <result property="deletedAt" column="deleted_at" />
        <result property="rowVersion" column="row_version" />
        <result property="finishMonth" column="finish_month" />
    </resultMap>

    <sql id="MediaItem_Columns">
        id,
        user_id,
        library_id,
        status,
        rating,
        notes,
        start_date,
        finish_date,
        custom_title,
        custom_cover_url,
        custom_source,
        created_at,
        updated_at,
        deleted_at,
        row_version,
        finish_month
    </sql>

    <select id="selectById" resultMap="MediaItemResultMap">
        SELECT <include refid="MediaItem_Columns" />
        FROM media_items
        WHERE id = #{id}
    </select>

    <select id="selectAll" resultMap="MediaItemResultMap">
        SELECT <include refid="MediaItem_Columns" />
        FROM media_items
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id"
            parameterType="com.acgm.acgmmediatracker.entity.MediaItem">
        INSERT INTO media_items (
            user_id,
            library_id,
            status,
            rating,
            notes,
            start_date,
            finish_date,
            custom_title,
            custom_cover_url,
            custom_source,
            deleted_at,
            row_version
        ) VALUES (
            #{userId},
            #{libraryId},
            #{status},
            #{rating},
            #{notes},
            #{startDate},
            #{finishDate},
            #{customTitle},
            #{customCoverUrl},
            #{customSource},
            #{deletedAt},
            COALESCE(#{rowVersion}, 0)
        )
    </insert>

    <update id="update" parameterType="com.acgm.acgmmediatracker.entity.MediaItem">
        UPDATE media_items
        SET
            user_id = #{userId},
            library_id = #{libraryId},
            status = #{status},
            rating = #{rating},
            notes = #{notes},
            start_date = #{startDate},
            finish_date = #{finishDate},
            custom_title = #{customTitle},
            custom_cover_url = #{customCoverUrl},
            custom_source = #{customSource},
            deleted_at = #{deletedAt},
            row_version = #{rowVersion}
        WHERE id = #{id}
    </update>

    <delete id="delete">
        DELETE FROM media_items
        WHERE id = #{id}
    </delete>

</mapper>
